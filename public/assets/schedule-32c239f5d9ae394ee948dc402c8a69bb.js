(function(){var t,e,a,o;a=function(t){var e;return e=$(t).data("slot"),$(t).css("position","absolute"),$(t).css("left",e.offset().left),$(t).css("top",e.offset().top)},o=function(t){return null==t&&(t=""),$.ajax({url:$("form#update-track").attr("action"),data:{track_id:t},dataType:"html",success:function(t){return $("ul#unscheduled-events").html(t)}})},t=function(t,e,o){return null==o&&(o=!0),t=$(t),e=$(e),t.data("slot",e),e.append($(t)),a(t),o?(t.data("time",e.data("time")),t.data("room",e.data("room")),$.ajax({url:t.data("update-url"),data:{event:{start_time:e.data("time"),room_id:e.parents("table.room").data("room-id")}},type:"PUT",dataType:"script",success:function(){return t.effect("highlight")}})):void 0},e=function(t){return t.draggable({revert:"invalid",opacity:.4,cursorAt:{left:5,top:5}})},$(function(){var r,n,d,l,s,i,u,c,m,v,f,p,h,g;for($("body").delegate("div.event","mouseenter",function(){var t,e;return t=$(this),t.find("a.close").length>0?void 0:(e=$("<a href='#'>\xd7</a>"),e.addClass("close").addClass("small"),t.prepend(e),e.click(function(e){return $.ajax({url:t.data("update-url"),data:{event:{start_time:null,room_id:null}},type:"PUT",dataType:"script",success:function(){return t.remove(),o()}}),e.stopPropagation(),e.preventDefault()}))}),$("body").delegate("div.event","mouseleave",function(){return $(this).find("a.close").remove()}),$("body").delegate("div.event","click",function(t){return t.stopPropagation(),t.preventDefault()}),f=$("a.toggle-room"),s=0,c=f.length;c>s;s++)r=f[s],$(r).click(function(){var t,e,o,r,n,d;for(t=$(this),$("table[data-room='"+t.data("room")+"']").toggle(),t.hasClass("success")?t.removeClass("success"):t.addClass("success"),n=$("table.room div.event"),d=[],o=0,r=n.length;r>o;o++)e=n[o],d.push(a(e));return d});for($("a#hide-all-rooms").click(function(){return $("a.toggle-room").removeClass("success"),$("table.room").hide()}),$("select#track_select").change(function(){return o($(this).val())}),p=$("table.room td"),i=0,m=p.length;m>i;i++)l=p[i],$(l).droppable({hoverClass:"event-hover",tolerance:"pointer",drop:function(e,a){return t(a.draggable,this)}});for($("#add-event-modal").modal(),$("body").delegate("table.room td","click",function(a){var o;return o=$(this),$("#add-event-modal #current-time").html(o.data("time")),$("ul#unscheduled-events").undelegate("click"),$("ul#unscheduled-events").delegate("li a","click",function(a){var r,n;return r=$(this).parent(),n=$("<div></div>"),n.html(r.children().first().html()),n.addClass("event"),n.attr("id",r.attr("id")),n.css("height",r.data("height")),n.data("update-url",r.data("update-url")),$("#event-pane").append(n),t(n,o),e(n),r.remove(),$("#add-event-modal").modal("hide"),a.preventDefault()}),$("#add-event-modal").modal("show"),a.stopPropagation()}),h=$("div.event"),g=[],u=0,v=h.length;v>u;u++)n=h[u],$(n).data("room")&&$(n).data("time")&&(d=$("table[data-room='"+$(n).data("room")+"']").find("td[data-time='"+$(n).data("time")+"']"),t(n,d,!1)),g.push(e($(n)));return g})}).call(this);